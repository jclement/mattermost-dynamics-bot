<div ng-show="loaded && !error">
<table class="table table-condensed table-striped">
  <tr>
    <th>ID:</th>
    <td>{{incident.Id}}</td>
  </tr>
  <tr>
    <th>Number:</th>
    <td>{{incidentNumber}} <a class="pull-right btn btn-default btn-xs" href="{{url}}">Open in Dynamics CRM</a> </td>
  </tr>
  <tr>
    <th>Title:</th>
    <td>{{incident.Title}}</td>
  </tr>
  <tr>
    <th>Status:</th>
    <td>{{incident.Status}}</td>
  </tr>
  <tr>
    <th>Description:</th>
    <td>{{incident.Description}}</td>
  </tr>
  <tr>
    <th>Version:</th>
    <td>{{incident.Version}}</td>
  </tr>
  <tr>
    <th>Company:</th>
    <td>{{incident.Company}}</td>
  </tr>
  <tr>
    <th>Creator:</th>
    <td>{{incident.Creator}}</td>
  </tr>
  <tr>
    <th>Owner:</th>
    <td>{{incident.Owner}}</td>
  </tr>
  <tr>
    <th>Attachments Folder:</th>
    <td>{{incident.NetworkAttachmentsFolder}}</td>
  </tr>
  <tr ng-show="incident.NetworkAttachments">
    <th>Attachments:</th>
    <td>
      <table class="table table-condensed">
      <tr>
        <th>Filename</th>
        <th>Size (kb)</th>
        <th>Owner</th>
        <th>Modified</th>
        <th>Created</th>
      </tr>
      <tr ng-repeat="attachment in incident.NetworkAttachments | orderBy: '-ModifiedDate'">
        <td><a href="../incident/{{incidentNumber}}/attachments/{{attachment.Filename}}">{{attachment.Filename}}</a></td>
        <td>{{attachment.SizeKB}}</td>
        <td>{{attachment.Owner}}</td>
        <td>{{attachment.Modified | date: "medium"}}</td>
        <td>{{attachment.Created | date: "medium"}}</td>
      </tr>
      </table>
    </td>
  </tr>
</table>

<div class="well well-sm" ng-hide="commentPosting">
  <input type="text" class="form-control" ng-model="newCommentTitle" placeholder="New Comment Title">
  <textarea class="form-control" ng-model="newCommentBody" placeholder="New Comment Body">
  </textarea>
  <button class="btn btn-default" ng-click="addComment()">Add Note</button>
</div>

<div class="well well-sm" ng-show="commentPosting">
  Posting...
</div>

<div class="well well-sm" ng-repeat="note in incident.Notes | orderBy: '-Modified'">
  <div style="border-bottom: 1px solid #aaa;"><b>{{note.Title}}</b> by <i>{{note.Owner}}</i> on {{note.Modified | date : "medium"}}</div>
  <div ng-bind-html="note.Body | marked"></div>
  <div ng-show="note.Filename">Download attachment (new tab): {{note.Filename}} ({{note.Filesize}} Bytes) <a class="btn btn-default" href={{"../attachment/getfile/"+note.Id+"/"+note.Filename}} target="_blank"><span class="glyphicon glyphicon-download-alt"></span></a></div>
  <div ng-show="note.Filename">Download attachment (iframe): {{note.Filename}} ({{note.Filesize}} Bytes) <button class="btn btn-default" ng-click="downloadNoteAttachment(note.Id, note.Filename)"><span class="glyphicon glyphicon-download-alt"></span></button></div>
</div>

</div>

<p ng-hide="loaded">Loading...</p>

<p ng-show="error" class="alert alert-danger">{{error}}</p>
<iframe id="download_iframe" style="display:none;"></iframe>